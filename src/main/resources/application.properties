# ========================================
# Spring Boot 應用程式配置檔
# ========================================
# 這個檔案定義了 Spring Boot 應用程式的所有配置
# 包含資料庫連線、JPA 設定、JWT 設定、Session 設定等
# 
# 環境變數優先級：
# - 環境變數 > application.properties 中的預設值
# - Azure 會自動注入環境變數，所以不需要在這裡寫實際的資料庫密碼

# ========================================
# 應用程式基本資訊
# ========================================
spring.application.name=demo

# ========================================
# 資料庫連線設定
# ========================================
# 使用環境變數配置（Azure 部署時會自動注入）
# ${變數名:預設值} 語法：如果環境變數不存在，就使用預設值
# 本地開發時使用預設值，Azure 部署時使用環境變數

# JDBC 連線 URL
# JDBC (Java Database Connectivity) 是 Java 語言中用來規範客戶端程式如何存取資料庫的 應用程式介面 (API)
# 格式：jdbc:postgresql://主機位址:埠號/資料庫名稱
# [JDBC 連線 URL 配置詳解]
# 語法結構：${環境變數名稱:預設值}
# 1. 優先級：Spring 會先找系統環境變數 SPRING_DATASOURCE_URL。
# 2. 雲端部署 (如 Azure/Docker)：雲端平台會自動注入此變數，程式將連向雲端資料庫（如生產環境 DB）。
# 3. 本地開發 (Local)：若環境變數不存在（即 $env:SPRING_DATASOURCE_URL 為空），則自動切換為冒號後的預設值。
# 4. 預設連線地址：jdbc:postgresql://localhost:5432/demo (連向本地安裝的 PostgreSQL)。
spring.datasource.url=${SPRING_DATASOURCE_URL:jdbc:postgresql://localhost:5432/demo}

# 資料庫使用者名稱
spring.datasource.username=${SPRING_DATASOURCE_USERNAME:postgres}

# 資料庫密碼（生產環境請使用環境變數，不要寫死在這裡）
spring.datasource.password=${SPRING_DATASOURCE_PASSWORD:postgres123}

# ========================================
# HikariCP 連接池設定
# ========================================
# HikariCP 是 Spring Boot 預設的資料庫連接池，管理資料庫連線的生命週期
# 連接池可以重複使用資料庫連線，避免每次查詢都建立新連線，提升效能

# 最大連線數（Azure 免費層建議設 5，避免超過資料庫連線限制）
spring.datasource.hikari.maximum-pool-size=5

# 最小閒置連線數（保持一定數量的連線待命，加快回應速度）
spring.datasource.hikari.minimum-idle=2

# 連線逾時時間（30 秒，如果無法取得連線就拋出例外）
spring.datasource.hikari.connection-timeout=30000

# ========================================
# JPA/Hibernate 設定
# ========================================
# JPA (Java Persistence API) 是 Java 的 ORM 標準
# Hibernate 是 JPA 的實作，負責將 Java 物件對應到資料庫表格

# 是否在 Console 顯示 SQL 語句（開發時設 true，生產環境設 false）
# 可以看到 JPA 實際執行的 SQL，方便除錯
spring.jpa.show-sql=${JPA_SHOW_SQL:false}

# DDL 自動生成策略
# - create: 每次啟動都重建資料表（會刪除舊資料）
# - update: 只更新資料表結構，不刪除資料（開發環境常用）
# - validate: 只驗證資料表結構是否正確，不修改
# - none: 不自動管理資料表（生產環境建議）
spring.jpa.hibernate.ddl-auto=${JPA_DDL_AUTO:update}

# PostgreSQL 方言（告訴 Hibernate 使用 PostgreSQL 專屬的 SQL 語法）
spring.jpa.properties.hibernate.dialect=org.hibernate.dialect.PostgreSQLDialect

# ========================================
# JWT (JSON Web Token) 設定
# ========================================
# JWT 用於實現無狀態的身份認證
# 用戶登入後，後端生成 JWT Token 回傳給前端
# 之後前端每次請求都帶上 Token，後端驗證 Token 即可識別用戶

# JWT 密鑰（用於簽署和驗證 Token）
# 生產環境務必使用環境變數，且至少 256 bits（32 個字元）
# ⚠️ 絕對不要把生產環境的密鑰寫在程式碼裡！
jwt.secret=${JWT_SECRET:your-very-secure-secret-key-that-should-be-at-least-256-bits-long-for-HS256-algorithm}

# JWT 過期時間（毫秒）
# 86400000ms = 24 小時
# Token 過期後需要重新登入
jwt.expiration=${JWT_EXPIRATION:86400000}

# ========================================
# Session 設定
# ========================================
# 雖然使用 JWT，但 Spring Security 預設還是會建立 Session
# 這裡的設定是為了向後兼容和安全性考量

# Session 過期時間（30 分鐘）
server.servlet.session.timeout=30m

# Session Cookie 名稱
server.servlet.session.cookie.name=JSESSIONID

# HttpOnly（防止 JavaScript 存取 Cookie，避免 XSS 攻擊）
server.servlet.session.cookie.http-only=true

# Secure（只在 HTTPS 傳輸 Cookie，生產環境應設為 true）
server.servlet.session.cookie.secure=${COOKIE_SECURE:false}

# SameSite（防止 CSRF 攻擊）
# - strict: 完全禁止跨站請求帶上 Cookie
# - lax: 允許部分跨站請求（如 GET）
# - none: 不限制（需搭配 Secure=true）
server.servlet.session.cookie.same-site=strict

# ========================================
# 伺服器設定
# ========================================
# Azure App Service 會透過環境變數 SERVER_PORT 指定 port
# 本地開發預設使用 8080
server.port=${SERVER_PORT:8080}

# ========================================
# Swagger/OpenAPI 設定
# ========================================
# springdoc-openapi 會自動掃描 Controller 並生成 API 文檔
# 訪問 http://localhost:8080/swagger-ui.html 即可看到互動式 API 文檔

# OpenAPI JSON 文檔路徑
springdoc.api-docs.path=/api-docs

# Swagger UI 網頁路徑
springdoc.swagger-ui.path=/swagger-ui.html

# API 標籤按字母排序（方便查找）
springdoc.swagger-ui.tags-sorter=alpha

# API 操作按字母排序
springdoc.swagger-ui.operations-sorter=alpha

# 只掃描指定 package 下的 Controller
springdoc.packages-to-scan=dev.backend.demo.controller

# 只顯示符合這些路徑的 API
springdoc.paths-to-match=/api/**,/health/**